# 0 is too far from ` ;)
# Start window numbering at 1 instead of 0.
set -g base-index 1

# Automatically set window title
# Allow tmux to rename windows based on the active program.
set-window-option -g automatic-rename on
# Allow tmux to set the terminal title shown by the terminal emulator.
set-option -g set-titles on

# Use tmux-256color when available, falling back for hosts without that terminfo.
if-shell 'infocmp tmux-256color >/dev/null 2>&1' 'set -g default-terminal "tmux-256color"' 'set -g default-terminal "xterm-256color"'
# Advertise RGB color support to xterm-256color and tmux-256color terminals.
set -sa terminal-overrides ",xterm-256color:RGB,tmux-256color:RGB"
# Also add RGB capability via terminal features for modern tmux versions.
set-option -sa terminal-features ',xterm-256color:RGB,tmux-256color:RGB'

# Allow passthrough of escape sequences (fixes symbols/Unicode in modern terminals)
set -gq allow-passthrough on

# Send focus in/out events so apps can react to focus changes.
set-option -g focus-events on

# Use vi-style keys in the status line prompt.
set -g status-keys vi
# Increase scrollback history size.
set -g history-limit 70000
# Enable mouse support for selection, resizing, and switching panes.
set -g mouse on

# Use vi-style keys in copy mode.
setw -g mode-keys vi
# Mark windows with activity when they receive output.
setw -g monitor-activity on

# Sync tmux's copy buffer with the system clipboard when possible.
set -g set-clipboard on

# Copy selection to clipboard (pbcopy locally, OSC 52 via set-clipboard remotely).
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'command -v pbcopy >/dev/null 2>&1 && pbcopy || cat >/dev/null'
# Copy selection on Enter as well for faster workflow.
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel 'command -v pbcopy >/dev/null 2>&1 && pbcopy || cat >/dev/null'

# Split the current pane horizontally and inherit its working directory.
bind-key v split-window -h -c "#{pane_current_path}"
# Split the current pane vertically and inherit its working directory.
bind-key s split-window -v -c "#{pane_current_path}"

# Resize the active pane down by 5 cells (prefix + Shift-J).
bind-key J resize-pane -D 5
# Resize the active pane up by 5 cells (prefix + Shift-K).
bind-key K resize-pane -U 5
# Resize the active pane left by 5 cells (prefix + Shift-H).
bind-key H resize-pane -L 5
# Resize the active pane right by 5 cells (prefix + Shift-L).
bind-key L resize-pane -R 5

# Resize the active pane down by 1 cell (prefix + Alt-j).
bind-key M-j resize-pane -D
# Resize the active pane up by 1 cell (prefix + Alt-k).
bind-key M-k resize-pane -U
# Resize the active pane left by 1 cell (prefix + Alt-h).
bind-key M-h resize-pane -L
# Resize the active pane right by 1 cell (prefix + Alt-l).
bind-key M-l resize-pane -R

# Vim style pane selection
# Select the pane to the left (prefix + h).
bind h select-pane -L
# Select the pane below (prefix + j).
bind j select-pane -D
# Select the pane above (prefix + k).
bind k select-pane -U
# Select the pane to the right (prefix + l).
bind l select-pane -R

# Use Alt-vim keys without prefix key to switch panes
# Select the pane to the left (Alt-h).
bind -n M-h select-pane -L
# Select the pane below (Alt-j).
bind -n M-j select-pane -D
# Select the pane above (Alt-k).
bind -n M-k select-pane -U
# Select the pane to the right (Alt-l).
bind -n M-l select-pane -R

# Use Alt-arrow keys without prefix key to switch panes
# Select the pane to the left (Alt-Left).
bind -n M-Left select-pane -L
# Select the pane to the right (Alt-Right).
bind -n M-Right select-pane -R
# Select the pane above (Alt-Up).
bind -n M-Up select-pane -U
# Select the pane below (Alt-Down).
bind -n M-Down select-pane -D

# Shift arrow to switch windows
# Go to the previous window (Shift-Left).
bind -n S-Left  previous-window
# Go to the next window (Shift-Right).
bind -n S-Right next-window

# No delay for escape key press
# Remove the escape key timeout to make vi-like navigation snappier.
set -sg escape-time 0

# Reload tmux config
# Reload this tmux configuration file (prefix + r).
bind r source-file ~/.tmux.conf

# THEME
# Set status bar background color.
set -g status-bg black
# Set status bar foreground color.
set -g status-fg white
# Refresh the status line every 60 seconds.
set -g status-interval 60
# Reserve 50 characters for the left side (session, host, SSH indicator).
set -g status-left-length 50
# Reserve 120 characters for the right side (load, path, time).
set -g status-right-length 120
# Show session name, user, hostname, and SSH/local indicator on the left.
set -g status-left '#[fg=green](#S) #[fg=white]#(whoami)#[default]@#[fg=cyan]#H#[default] #[fg=magenta]#(test -n "$SSH_CONNECTION" && echo SSH || echo LOCAL)#[default]'
# Show load averages (1/5/15m), current path, and time on the right (macOS/Linux friendly).
set -g status-right '#[fg=yellow]load 1/5/15: #(if [ -r /proc/loadavg ]; then cut -d " " -f 1-3 /proc/loadavg; else sysctl -n vm.loadavg | tr -d "{}," | xargs; fi)#[default] #[fg=blue]#{pane_current_path}#[default] #[fg=white]%H:%M#[default]'
